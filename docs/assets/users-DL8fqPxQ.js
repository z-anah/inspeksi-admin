import{r as i,b3 as z,D as L,c as C,o as v,d as c,f as g,m as w,b as l,e as a,Z as p,t as u,v as b,Y as M,a1 as Y}from"./index-C_Fo-Q1Z.js";import{s as x}from"./supabase-dF8vZqmp.js";import{V as _,b as q,c as B}from"./VCard-DIix0bcz.js";import{V as U}from"./VAlert-Cp-4rYs2.js";import{V as Z}from"./VDataTable-Biu5DSsd.js";import{V as N}from"./VCardText-oi22yba3.js";import{V as G}from"./VForm-BeUWgbEy.js";import{a as T}from"./VTextField-B25NbKOl.js";import{V as E}from"./VSpacer-_k1Z9FJN.js";import{V as I}from"./VDialog-BhUTdbvn.js";import"./_commonjsHelpers-BosuxZz1.js";import"./VAvatar-C3GauEvc.js";import"./VImg-BUi6ipbq.js";import"./forwardRefs-DWGaNmQL.js";import"./VList-JGcb-0Dy.js";import"./VDivider-Cl56lCsf.js";import"./VOverlay-D2VBwOt_.js";import"./VMenu-CKbpf5eF.js";import"./VChip-D-vlibiD.js";/* empty css              */const H={class:"p-6"},J={class:"mb-8"},K={key:0},Q={key:1,class:"text-gray-400"},R={class:"text-xs text-gray-500"},Ve={__name:"users",setup(W){const D=i([]),d=i(!1),o=i(""),m=i(""),f=i(!1),y=i(!1),n=i(!1),r=z({id:null,username:"",password:""}),A=i(null),V=i(""),k=async()=>{V.value=localStorage.getItem("user_name"),d.value=!0,o.value="";const{data:t,error:e}=await x.from("users").select("id, username, password, created_at").order("created_at",{ascending:!1});e?o.value=e.message:D.value=t,d.value=!1},$=()=>{n.value=!1,Object.assign(r,{id:null,username:"",password:"pass1234"}),f.value=!0,o.value="",m.value='Default password will be "pass1234"'},j=t=>{n.value=!0,Object.assign(r,t),f.value=!0,o.value="",m.value=""},S=async()=>{if(o.value="",m.value="",!r.username){o.value="Username is required";return}d.value=!0;let t;if(n.value)if(r.username===localStorage.getItem("user_name"))t=await x.from("users").update({password:r.password}).eq("id",r.id).select();else{d.value=!1,f.value=!1;return}else t=await x.from("users").insert([{username:r.username,password:"pass1234"}]).select(),t.error||(m.value='User created with default password "pass1234".');t&&t.error?o.value=t.error.message:(f.value=!1,k()),d.value=!1},F=t=>{A.value=t,y.value=!0},O=async()=>{d.value=!0,o.value="";const{error:t}=await x.from("users").delete().eq("id",A.value);t&&(o.value=t.message),y.value=!1,k(),d.value=!1};return L(k),(t,e)=>(v(),C("div",H,[c("div",J,[l(_,{flat:"",class:"py-6 px-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4 shadow-none border-b border-gray-200"},{default:a(()=>[e[7]||(e[7]=c("div",null,[c("h2",{class:"text-2xl font-bold mb-1"},"Users Management"),c("p",{class:"text-gray-500 text-base"}," Manage all users for your website. ")],-1)),l(p,{color:"primary",class:"mt-4 md:mt-0",onClick:$,size:"large","prepend-icon":"tabler-plus"},{default:a(()=>e[6]||(e[6]=[u(" Add User ")])),_:1})]),_:1})]),o.value?(v(),g(U,{key:0,type:"error",class:"mb-4"},{default:a(()=>[u(b(o.value),1)]),_:1})):w("",!0),m.value?(v(),g(U,{key:1,type:"info",class:"mb-4"},{default:a(()=>[u(b(m.value),1)]),_:1})):w("",!0),l(Z,{items:D.value,loading:d.value,class:"rounded-lg shadow",headers:[{title:"Username",key:"username"},{title:"Password",key:"password"},{title:"Created At",key:"created_at"},{title:"Actions",key:"actions",sortable:!1}],"item-value":"id",density:"comfortable"},{"item.password":a(({item:s})=>[s.username===V.value?(v(),C("span",K,b(s.password),1)):(v(),C("span",Q,"••••••••"))]),"item.created_at":a(({item:s})=>[c("span",R,b(new Date(s.created_at).toLocaleString()),1)]),"item.actions":a(({item:s})=>[l(p,{icon:"",variant:"text",color:"primary",onClick:P=>j(s),disabled:s.username!==V.value},{default:a(()=>[l(M,{icon:"tabler-edit"})]),_:2},1032,["onClick","disabled"]),l(p,{icon:"",variant:"text",color:"error",onClick:P=>F(s.id)},{default:a(()=>[l(M,{icon:"tabler-trash"})]),_:2},1032,["onClick"])]),"no-data":a(()=>e[8]||(e[8]=[c("div",{class:"text-center text-gray-400 py-8"},"No data.",-1)])),_:1},8,["items","loading"]),l(I,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=s=>f.value=s),"max-width":"400"},{default:a(()=>[l(_,null,{default:a(()=>[l(q,null,{default:a(()=>[u(b(n.value?"Edit User":"Add User"),1)]),_:1}),l(N,null,{default:a(()=>[l(G,{onSubmit:Y(S,["prevent"])},{default:a(()=>[l(T,{modelValue:r.username,"onUpdate:modelValue":e[0]||(e[0]=s=>r.username=s),label:"Username",required:"",class:"mb-4",disabled:n.value},null,8,["modelValue","disabled"]),!n.value||r.username===V.value?(v(),g(T,{key:0,modelValue:r.password,"onUpdate:modelValue":e[1]||(e[1]=s=>r.password=s),label:"Password",type:"text",required:"",class:"mb-4",readonly:!n.value},null,8,["modelValue","readonly"])):w("",!0),m.value&&!n.value?(v(),g(U,{key:1,type:"info",class:"mb-2"},{default:a(()=>[u(b(m.value),1)]),_:1})):w("",!0)]),_:1})]),_:1}),l(B,null,{default:a(()=>[l(E),l(p,{text:"",onClick:e[2]||(e[2]=s=>f.value=!1)},{default:a(()=>e[9]||(e[9]=[u("Cancel")])),_:1}),l(p,{color:"primary",loading:d.value,onClick:S,disabled:n.value&&r.username!==V.value},{default:a(()=>e[10]||(e[10]=[u(" Save ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(I,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=s=>y.value=s),"max-width":"400"},{default:a(()=>[l(_,null,{default:a(()=>[l(q,null,{default:a(()=>e[11]||(e[11]=[u("Delete User?")])),_:1}),l(N,null,{default:a(()=>e[12]||(e[12]=[u(" Are you sure you want to delete this user? ")])),_:1}),l(B,null,{default:a(()=>[l(E),l(p,{text:"",onClick:e[4]||(e[4]=s=>y.value=!1)},{default:a(()=>e[13]||(e[13]=[u("Cancel")])),_:1}),l(p,{color:"error",loading:d.value,onClick:O},{default:a(()=>e[14]||(e[14]=[u(" Delete ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Ve as default};
