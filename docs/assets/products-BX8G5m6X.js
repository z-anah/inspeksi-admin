import{r as d,ao as R,E as X,c as k,o as p,d as n,f as C,m as y,b as t,e as l,$ as f,t as u,v as P,Z as x,a3 as Y,F as h,i as ee,bb as te,a0 as i}from"./index-Cs56v0At.js";import{V as S,b as M,c as T}from"./VCard-DA4IPDsH.js";import{V as j}from"./VAlert-DdpZmKKI.js";import{V as ae}from"./VDataTable-CE2rUsw4.js";import{V as z}from"./VCardText-DFV2BJbA.js";import{V as re}from"./VForm-Dr6CSLn8.js";import{d as $}from"./VTextField-C4XJx2Dz.js";import{V as le}from"./VTextarea-DSQ_Dxo0.js";import{V as oe}from"./VImg-BZXzfXOW.js";import{V as F}from"./VSpacer-S0PcfrqZ.js";import{V as L}from"./VDialog-C5E9XUbD.js";import"./VAvatar-CilbXriq.js";import"./VSelect-BDhU9j2u.js";import"./forwardRefs-DWGaNmQL.js";import"./VList-Bpo7c8Lz.js";import"./ssrBoot-BF_zi78u.js";import"./VDivider-CaB5QsUp.js";import"./VOverlay-CAZCCTm0.js";import"./scopeId-Ca3ivWDp.js";import"./VMenu-C8WYHHPj.js";import"./VChip-DMWyfkQi.js";/* empty css              */const se={class:"p-6"},ie={class:"mb-8"},de={class:"text-xs text-gray-500"},ne={key:0,class:"mt-8"},ue={class:"flex flex-wrap gap-4 mb-4"},me={key:1,class:"absolute bottom-1 left-1 bg-primary text-white text-xs px-2 py-0.5 rounded"},ce={class:"w-28 h-28 border-dashed border-2 border-gray-300 rounded flex flex-col items-center justify-center cursor-pointer hover:border-primary"},Te={__name:"products",setup(pe){const m=d(!1),c=d(""),N=d([]),v=d(!1),b=d(!1),V=d(!1),r=R({id:null,name:"",description:"",price:"",stock:""}),U=d(null),D=d([]),_=d(!1),s=d(""),q=async()=>{m.value=!0,c.value="";const{data:o,error:e}=await i.from("products").select("*").order("created_at",{ascending:!1});e?c.value=e.message:N.value=o,m.value=!1},w=async o=>{if(!o)return;const{data:e,error:a}=await i.from("product_images").select("*").eq("product_id",o).order("is_primary",{ascending:!1}).order("id",{ascending:!0});a||(D.value=e)},O=()=>{V.value=!1,Object.assign(r,{id:null,name:"",description:"",price:"",stock:""}),v.value=!0,D.value=[],s.value=""},W=o=>{V.value=!0,Object.assign(r,o),v.value=!0,w(o.id)},I=async()=>{if(!r.name||!r.price||!r.stock){c.value="Name, Price, and Stock are required";return}m.value=!0,c.value="";let o;V.value?o=await i.from("products").update({name:r.name,description:r.description,price:r.price,stock:r.stock}).eq("id",r.id).select():o=await i.from("products").insert([{name:r.name,description:r.description,price:r.price,stock:r.stock}]).select(),o.error?c.value=o.error.message:(v.value=!1,q()),m.value=!1},Z=o=>{U.value=o,b.value=!0},G=async()=>{m.value=!0,c.value="";const{error:o}=await i.from("products").delete().eq("id",U.value);o&&(c.value=o.message),b.value=!1,q(),m.value=!1},H=async o=>{s.value="";const e=o.target.files[0];if(!e)return;if(!e.type.startsWith("image/")){s.value="Only image files are allowed.";return}if(e.size>2*1024*1024){s.value="Image must be less than 2MB.";return}_.value=!0;const a=e.name.split(".").pop(),g=`product_${r.id}_${Date.now()}.${a}`,{data:fe,error:A}=await i.storage.from("product-images").upload(g,e);if(A){s.value=A.message,_.value=!1;return}const{data:E}=i.storage.from("product-images").getPublicUrl(g),Q=E==null?void 0:E.publicUrl,{error:B}=await i.from("product_images").insert([{product_id:r.id,image_url:Q}]);B&&(s.value=B.message),await w(r.id),_.value=!1},J=async o=>{s.value="";const{error:e}=await i.from("product_images").delete().eq("id",o);e&&(s.value=e.message),await w(r.id)},K=async o=>{s.value="";const{error:e}=await i.from("product_images").update({is_primary:!1}).eq("product_id",r.id);if(e){s.value=e.message;return}const{error:a}=await i.from("product_images").update({is_primary:!0}).eq("id",o);a&&(s.value=a.message),await w(r.id)};return X(q),(o,e)=>(p(),k("div",se,[n("div",ie,[t(S,{flat:"",class:"py-6 px-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4 shadow-none border-b border-gray-200"},{default:l(()=>[e[9]||(e[9]=n("div",null,[n("h2",{class:"text-2xl font-bold mb-1"},"Product Management"),n("p",{class:"text-gray-500 text-base"}," Manage your products and inventory. ")],-1)),t(f,{color:"primary",class:"mt-4 md:mt-0",onClick:O,size:"large","prepend-icon":"tabler-plus"},{default:l(()=>e[8]||(e[8]=[u(" Add Product ")])),_:1})]),_:1})]),c.value?(p(),C(j,{key:0,type:"error",class:"mb-4"},{default:l(()=>[u(P(c.value),1)]),_:1})):y("",!0),t(ae,{items:N.value,loading:m.value,class:"rounded-lg shadow",headers:[{title:"Name",key:"name"},{title:"Price",key:"price"},{title:"Stock",key:"stock"},{title:"Created",key:"created_at"},{title:"Actions",key:"actions",sortable:!1}],"item-value":"id",density:"comfortable"},{"item.created_at":l(({item:a})=>[n("span",de,P(new Date(a.created_at).toLocaleString()),1)]),"item.actions":l(({item:a})=>[t(f,{icon:"",variant:"text",color:"primary",onClick:g=>W(a)},{default:l(()=>[t(x,{icon:"tabler-edit"})]),_:2},1032,["onClick"]),t(f,{icon:"",variant:"text",color:"error",onClick:g=>Z(a.id)},{default:l(()=>[t(x,{icon:"tabler-trash"})]),_:2},1032,["onClick"])]),"no-data":l(()=>e[10]||(e[10]=[n("div",{class:"text-center text-gray-400 py-8"},"No products.",-1)])),_:1},8,["items","loading"]),t(L,{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=a=>v.value=a),"max-width":"600"},{default:l(()=>[t(S,null,{default:l(()=>[t(M,null,{default:l(()=>[u(P(V.value?"Edit Product":"Add Product"),1)]),_:1}),t(z,null,{default:l(()=>[t(re,{onSubmit:Y(I,["prevent"])},{default:l(()=>[t($,{modelValue:r.name,"onUpdate:modelValue":e[0]||(e[0]=a=>r.name=a),label:"Name",required:"",class:"mb-4"},null,8,["modelValue"]),t(le,{modelValue:r.description,"onUpdate:modelValue":e[1]||(e[1]=a=>r.description=a),label:"Description",rows:"2",class:"mb-4"},null,8,["modelValue"]),t($,{modelValue:r.price,"onUpdate:modelValue":e[2]||(e[2]=a=>r.price=a),label:"Price",type:"number",min:"0",step:"0.01",required:"",class:"mb-4"},null,8,["modelValue"]),t($,{modelValue:r.stock,"onUpdate:modelValue":e[3]||(e[3]=a=>r.stock=a),label:"Stock",type:"number",min:"0",required:"",class:"mb-4"},null,8,["modelValue"])]),_:1}),V.value?(p(),k("div",ne,[e[11]||(e[11]=n("h3",{class:"font-semibold mb-2"},"Product Images",-1)),n("div",ue,[(p(!0),k(h,null,ee(D.value,a=>(p(),k("div",{key:a.id,class:"relative w-28 h-28 border rounded overflow-hidden flex flex-col items-center justify-center mb-4"},[t(oe,{src:a.image_url,alt:"Product image",height:"100"},null,8,["src"]),t(f,{icon:"",size:"x-small",color:"error",class:"absolute top-1 right-1",onClick:g=>J(a.id),title:"Delete"},{default:l(()=>[t(x,{icon:"tabler-trash"})]),_:2},1032,["onClick"]),a.is_primary?y("",!0):(p(),C(f,{key:0,icon:"",size:"x-small",color:"primary",class:"absolute bottom-1 left-1",onClick:g=>K(a.id),title:"Set as primary"},{default:l(()=>[t(x,{icon:"tabler-star"})]),_:2},1032,["onClick"])),a.is_primary?(p(),k("span",me,"Primary")):y("",!0)]))),128)),n("label",ce,[t(x,{icon:"tabler-plus",size:"32",class:"text-gray-400"}),n("input",{type:"file",accept:"image/*",class:"hidden",onChange:H},null,32)])]),_.value?(p(),C(te,{key:0,indeterminate:"",color:"primary",class:"mb-2"})):y("",!0),s.value?(p(),C(j,{key:1,type:"error",class:"mb-2"},{default:l(()=>[u(P(s.value),1)]),_:1})):y("",!0)])):y("",!0)]),_:1}),t(T,null,{default:l(()=>[t(F),t(f,{text:"",onClick:e[4]||(e[4]=a=>v.value=!1)},{default:l(()=>e[12]||(e[12]=[u("Cancel")])),_:1}),t(f,{color:"primary",loading:m.value,onClick:I},{default:l(()=>e[13]||(e[13]=[u(" Save ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(L,{modelValue:b.value,"onUpdate:modelValue":e[7]||(e[7]=a=>b.value=a),"max-width":"400"},{default:l(()=>[t(S,null,{default:l(()=>[t(M,null,{default:l(()=>e[14]||(e[14]=[u("Delete Product?")])),_:1}),t(z,null,{default:l(()=>e[15]||(e[15]=[u(" Are you sure you want to delete this product? ")])),_:1}),t(T,null,{default:l(()=>[t(F),t(f,{text:"",onClick:e[6]||(e[6]=a=>b.value=!1)},{default:l(()=>e[16]||(e[16]=[u("Cancel")])),_:1}),t(f,{color:"error",loading:m.value,onClick:G},{default:l(()=>e[17]||(e[17]=[u(" Delete ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Te as default};
