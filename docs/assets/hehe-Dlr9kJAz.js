import{_ as T}from"./AppTextarea-Bs-5jeKk.js";import{_ as $}from"./AppTextField-C9As2h6K.js";import{i as P,j as S,r as c,am as q,D,c as m,o as d,d as r,b as l,e as o,s as f,t as C,f as N,l as V,a1 as B,F as E,h as F,Z as h,Y as M,m as R}from"./index-DlJANnYd.js";import{s as _}from"./supabase-BzEWn3Nz.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{b as L,c as O,V as z}from"./VCard-D_fsEcSS.js";import{V as H}from"./VCardText-BPQfIJ-x.js";import{V as K}from"./VAlert-D6AfPq5Y.js";import{V as Y}from"./VForm-CZCxUfyJ.js";import{V as Z}from"./VSpacer-C3GwWcfp.js";import"./VTextField-DDrVlWqV.js";import"./VImg-qd_ukxwb.js";import"./forwardRefs-DWGaNmQL.js";import"./VTextarea-DUXMXu2G.js";import"./_commonjsHelpers-BosuxZz1.js";import"./VAvatar-BGAsHGGR.js";/* empty css              */const G={class:"page-layout"},J={class:"main-content"},Q={class:"p-6 max-w-2xl mx-auto"},W={class:"mb-4"},X=["disabled"],ee={key:0,class:"text-sm text-gray-500 mt-1"},te={key:1,class:"text-sm text-red-500 mt-1"},ae={key:2,class:"mt-2"},le=["src"],se={class:"mb-4"},oe={__name:"hehe",setup(re){const k=P(),A=S(),p=c(!1),n=c(""),g=c(k.params.id!=="new"),e=q({id:null,type:"",title:"",published_at:"",image_url:"",content:[]}),v=c(!1),b=c(""),w=async a=>{const t=a.target.files[0];if(t){v.value=!0,b.value="";try{const i=t.name.split(".").pop(),x=`${Date.now()}-${Math.random().toString(36).substring(2)}.${i}`,{data:s,error:u}=await _.storage.from("product-images").upload(x,t,{cacheControl:"3600",upsert:!1});if(u)throw u;const{data:y}=_.storage.from("product-images").getPublicUrl(s.path);e.image_url=y.publicUrl}catch(i){b.value=i.message||"Upload failed"}v.value=!1}},I=async()=>{if(!g.value)return;p.value=!0,n.value="";const{data:a,error:t}=await _.from("articles").select("*").eq("id",k.params.id).single();t?n.value=t.message:Object.assign(e,{...a,content:Array.isArray(a.content)?a.content:a.content?[a.content]:[],type:a.type?a.type.toUpperCase():""}),p.value=!1},U=async()=>{if(!e.type||!e.title||!e.published_at||!e.content.length){n.value="Type, Title, Published Date, and Content are required";return}p.value=!0,n.value="";let a;g.value?a=await _.from("articles").update({type:e.type,title:e.title,published_at:e.published_at,image_url:e.image_url,content:e.content}).eq("id",e.id).select():a=await _.from("articles").insert([{type:e.type,title:e.title,published_at:e.published_at,image_url:e.image_url,content:e.content}]).select(),a.error?n.value=a.error.message:A.push({name:"admin"}),p.value=!1};return D(()=>{g.value&&I()}),(a,t)=>{const i=$,x=T;return d(),m("div",G,[r("main",J,[r("div",Q,[l(z,null,{default:o(()=>[l(L,null,{default:o(()=>[f(C(g.value?"Edit Article":"Add Article"),1)]),_:1}),l(H,null,{default:o(()=>[n.value?(d(),N(K,{key:0,type:"error",class:"mb-4"},{default:o(()=>[f(C(n.value),1)]),_:1})):V("",!0),l(Y,{onSubmit:B(U,["prevent"])},{default:o(()=>[l(i,{modelValue:e.type,"onUpdate:modelValue":t[0]||(t[0]=s=>e.type=s),label:"Type (e.g. OPINI, KISAH, RILIS)",required:"",class:"mb-4"},null,8,["modelValue"]),l(i,{modelValue:e.title,"onUpdate:modelValue":t[1]||(t[1]=s=>e.title=s),label:"Title",required:"",class:"mb-4"},null,8,["modelValue"]),l(i,{modelValue:e.published_at,"onUpdate:modelValue":t[2]||(t[2]=s=>e.published_at=s),label:"Published Date",type:"date",required:"",class:"mb-4"},null,8,["modelValue"]),r("div",W,[t[5]||(t[5]=r("label",{class:"block font-medium mb-1"},"Image",-1)),r("input",{type:"file",accept:"image/*",onChange:w,disabled:v.value},null,40,X),v.value?(d(),m("div",ee,"Uploading...")):V("",!0),b.value?(d(),m("div",te,C(b.value),1)):V("",!0),e.image_url?(d(),m("div",ae,[r("img",{src:e.image_url,alt:"Article Image",style:{"max-width":"200px","max-height":"200px"}},null,8,le)])):V("",!0)]),r("div",se,[t[7]||(t[7]=r("label",{class:"block font-medium mb-1"},"Content Paragraphs",-1)),(d(!0),m(E,null,F(e.content,(s,u)=>(d(),m("div",{key:u,class:"flex items-center gap-2 mb-2"},[l(x,{modelValue:e.content[u],"onUpdate:modelValue":y=>e.content[u]=y,"auto-grow":"",label:"Paragraph",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue"]),l(h,{icon:"",variant:"text",color:"error",onClick:y=>e.content.splice(u,1)},{default:o(()=>[l(M,{icon:"tabler-trash"})]),_:2},1032,["onClick"])]))),128)),l(h,{color:"secondary",variant:"tonal",size:"small",onClick:t[3]||(t[3]=s=>e.content.push(""))},{default:o(()=>t[6]||(t[6]=[f(" Add Paragraph ")])),_:1})])]),_:1})]),_:1}),l(O,null,{default:o(()=>[l(Z),l(h,{text:"",onClick:t[4]||(t[4]=s=>R(A).push({name:"admin"}))},{default:o(()=>t[8]||(t[8]=[f("Cancel")])),_:1}),l(h,{color:"primary",loading:p.value,onClick:U},{default:o(()=>t[9]||(t[9]=[f(" Save ")])),_:1},8,["loading"])]),_:1})]),_:1})])])])}}},ke=j(oe,[["__scopeId","data-v-821c2496"]]);export{ke as default};
