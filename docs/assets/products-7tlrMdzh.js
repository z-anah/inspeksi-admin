import{r as n,aF as K,D as Q,c as k,o as p,d,f as C,l as y,b as t,e as l,Z as f,s as u,t as P,Y as x,a1 as R,F as X,h as ee,aV as te}from"./index-qeOE-RZf.js";import{s as i}from"./supabase-530oTR8b.js";import{V as E,b as M,c as T}from"./VCard-DSA5d7tx.js";import{V as j}from"./VAlert-3engY8ay.js";import{V as ae}from"./VDataTable-DIwuVEqw.js";import{V as z}from"./VCardText-esC-nFTL.js";import{V as re}from"./VForm-D3l-Nezn.js";import{b as $}from"./VTextField-l-OaS9z9.js";import{V as le}from"./VTextarea-C_xe0QJ6.js";import{V as oe}from"./VImg-BuNpeMJc.js";import{V as F}from"./VSpacer-_ceUCEQo.js";import{V as L}from"./VDialog-BTxMSAHY.js";import"./_commonjsHelpers-BosuxZz1.js";import"./VAvatar-CrC7-P1Q.js";import"./forwardRefs-DWGaNmQL.js";import"./VList-dtqFoHiT.js";import"./ssrBoot-DzfblIhC.js";import"./VDivider-PwI-pKnj.js";import"./VOverlay-CG-9_lFx.js";import"./scopeId-Caf1NDu8.js";import"./lazy-DvqCi__j.js";import"./VMenu-BUbR1i_z.js";import"./VChip-D0U8pgGv.js";/* empty css              */const se={class:"p-6"},ie={class:"mb-8"},ne={class:"text-xs text-gray-500"},de={key:0,class:"mt-8"},ue={class:"flex flex-wrap gap-4 mb-4"},me={key:1,class:"absolute bottom-1 left-1 bg-primary text-white text-xs px-2 py-0.5 rounded"},ce={class:"w-28 h-28 border-dashed border-2 border-gray-300 rounded flex flex-col items-center justify-center cursor-pointer hover:border-primary"},ze={__name:"products",setup(pe){const m=n(!1),c=n(""),N=n([]),v=n(!1),b=n(!1),V=n(!1),r=K({id:null,name:"",description:"",price:"",stock:""}),U=n(null),D=n([]),_=n(!1),s=n(""),q=async()=>{m.value=!0,c.value="";const{data:o,error:e}=await i.from("products").select("*").order("created_at",{ascending:!1});e?c.value=e.message:N.value=o,m.value=!1},w=async o=>{if(!o)return;const{data:e,error:a}=await i.from("product_images").select("*").eq("product_id",o).order("is_primary",{ascending:!1}).order("id",{ascending:!0});a||(D.value=e)},O=()=>{V.value=!1,Object.assign(r,{id:null,name:"",description:"",price:"",stock:""}),v.value=!0,D.value=[],s.value=""},W=o=>{V.value=!0,Object.assign(r,o),v.value=!0,w(o.id)},I=async()=>{if(!r.name||!r.price||!r.stock){c.value="Name, Price, and Stock are required";return}m.value=!0,c.value="";let o;V.value?o=await i.from("products").update({name:r.name,description:r.description,price:r.price,stock:r.stock}).eq("id",r.id).select():o=await i.from("products").insert([{name:r.name,description:r.description,price:r.price,stock:r.stock}]).select(),o.error?c.value=o.error.message:(v.value=!1,q()),m.value=!1},Y=o=>{U.value=o,b.value=!0},Z=async()=>{m.value=!0,c.value="";const{error:o}=await i.from("products").delete().eq("id",U.value);o&&(c.value=o.message),b.value=!1,q(),m.value=!1},h=async o=>{s.value="";const e=o.target.files[0];if(!e)return;if(!e.type.startsWith("image/")){s.value="Only image files are allowed.";return}if(e.size>2*1024*1024){s.value="Image must be less than 2MB.";return}_.value=!0;const a=e.name.split(".").pop(),g=`product_${r.id}_${Date.now()}.${a}`,{data:fe,error:A}=await i.storage.from("product-images").upload(g,e);if(A){s.value=A.message,_.value=!1;return}const{data:S}=i.storage.from("product-images").getPublicUrl(g),J=S==null?void 0:S.publicUrl,{error:B}=await i.from("product_images").insert([{product_id:r.id,image_url:J}]);B&&(s.value=B.message),await w(r.id),_.value=!1},G=async o=>{s.value="";const{error:e}=await i.from("product_images").delete().eq("id",o);e&&(s.value=e.message),await w(r.id)},H=async o=>{s.value="";const{error:e}=await i.from("product_images").update({is_primary:!1}).eq("product_id",r.id);if(e){s.value=e.message;return}const{error:a}=await i.from("product_images").update({is_primary:!0}).eq("id",o);a&&(s.value=a.message),await w(r.id)};return Q(q),(o,e)=>(p(),k("div",se,[d("div",ie,[t(E,{flat:"",class:"py-6 px-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4 shadow-none border-b border-gray-200"},{default:l(()=>[e[9]||(e[9]=d("div",null,[d("h2",{class:"text-2xl font-bold mb-1"},"Product Management"),d("p",{class:"text-gray-500 text-base"}," Manage your products and inventory. ")],-1)),t(f,{color:"primary",class:"mt-4 md:mt-0",onClick:O,size:"large","prepend-icon":"tabler-plus"},{default:l(()=>e[8]||(e[8]=[u(" Add Product ")])),_:1})]),_:1})]),c.value?(p(),C(j,{key:0,type:"error",class:"mb-4"},{default:l(()=>[u(P(c.value),1)]),_:1})):y("",!0),t(ae,{items:N.value,loading:m.value,class:"rounded-lg shadow",headers:[{title:"Name",key:"name"},{title:"Description",key:"description"},{title:"Price",key:"price"},{title:"Stock",key:"stock"},{title:"Created",key:"created_at"},{title:"Actions",key:"actions",sortable:!1}],"item-value":"id",density:"comfortable"},{"item.created_at":l(({item:a})=>[d("span",ne,P(new Date(a.created_at).toLocaleString()),1)]),"item.actions":l(({item:a})=>[t(f,{icon:"",variant:"text",color:"primary",onClick:g=>W(a)},{default:l(()=>[t(x,{icon:"tabler-edit"})]),_:2},1032,["onClick"]),t(f,{icon:"",variant:"text",color:"error",onClick:g=>Y(a.id)},{default:l(()=>[t(x,{icon:"tabler-trash"})]),_:2},1032,["onClick"])]),"no-data":l(()=>e[10]||(e[10]=[d("div",{class:"text-center text-gray-400 py-8"},"No products.",-1)])),_:1},8,["items","loading"]),t(L,{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=a=>v.value=a),"max-width":"600"},{default:l(()=>[t(E,null,{default:l(()=>[t(M,null,{default:l(()=>[u(P(V.value?"Edit Product":"Add Product"),1)]),_:1}),t(z,null,{default:l(()=>[t(re,{onSubmit:R(I,["prevent"])},{default:l(()=>[t($,{modelValue:r.name,"onUpdate:modelValue":e[0]||(e[0]=a=>r.name=a),label:"Name",required:"",class:"mb-4"},null,8,["modelValue"]),t(le,{modelValue:r.description,"onUpdate:modelValue":e[1]||(e[1]=a=>r.description=a),label:"Description",rows:"2",class:"mb-4"},null,8,["modelValue"]),t($,{modelValue:r.price,"onUpdate:modelValue":e[2]||(e[2]=a=>r.price=a),label:"Price",type:"number",min:"0",step:"0.01",required:"",class:"mb-4"},null,8,["modelValue"]),t($,{modelValue:r.stock,"onUpdate:modelValue":e[3]||(e[3]=a=>r.stock=a),label:"Stock",type:"number",min:"0",required:"",class:"mb-4"},null,8,["modelValue"])]),_:1}),V.value?(p(),k("div",de,[e[11]||(e[11]=d("h3",{class:"font-semibold mb-2"},"Product Images",-1)),d("div",ue,[(p(!0),k(X,null,ee(D.value,a=>(p(),k("div",{key:a.id,class:"relative w-28 h-28 border rounded overflow-hidden flex flex-col items-center justify-center mb-4"},[t(oe,{src:a.image_url,alt:"Product image",height:"100"},null,8,["src"]),t(f,{icon:"",size:"x-small",color:"error",class:"absolute top-1 right-1",onClick:g=>G(a.id),title:"Delete"},{default:l(()=>[t(x,{icon:"tabler-trash"})]),_:2},1032,["onClick"]),a.is_primary?y("",!0):(p(),C(f,{key:0,icon:"",size:"x-small",color:"primary",class:"absolute bottom-1 left-1",onClick:g=>H(a.id),title:"Set as primary"},{default:l(()=>[t(x,{icon:"tabler-star"})]),_:2},1032,["onClick"])),a.is_primary?(p(),k("span",me,"Primary")):y("",!0)]))),128)),d("label",ce,[t(x,{icon:"tabler-plus",size:"32",class:"text-gray-400"}),d("input",{type:"file",accept:"image/*",class:"hidden",onChange:h},null,32)])]),_.value?(p(),C(te,{key:0,indeterminate:"",color:"primary",class:"mb-2"})):y("",!0),s.value?(p(),C(j,{key:1,type:"error",class:"mb-2"},{default:l(()=>[u(P(s.value),1)]),_:1})):y("",!0)])):y("",!0)]),_:1}),t(T,null,{default:l(()=>[t(F),t(f,{text:"",onClick:e[4]||(e[4]=a=>v.value=!1)},{default:l(()=>e[12]||(e[12]=[u("Cancel")])),_:1}),t(f,{color:"primary",loading:m.value,onClick:I},{default:l(()=>e[13]||(e[13]=[u(" Save ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(L,{modelValue:b.value,"onUpdate:modelValue":e[7]||(e[7]=a=>b.value=a),"max-width":"400"},{default:l(()=>[t(E,null,{default:l(()=>[t(M,null,{default:l(()=>e[14]||(e[14]=[u("Delete Product?")])),_:1}),t(z,null,{default:l(()=>e[15]||(e[15]=[u(" Are you sure you want to delete this product? ")])),_:1}),t(T,null,{default:l(()=>[t(F),t(f,{text:"",onClick:e[6]||(e[6]=a=>b.value=!1)},{default:l(()=>e[16]||(e[16]=[u("Cancel")])),_:1}),t(f,{color:"error",loading:m.value,onClick:Z},{default:l(()=>e[17]||(e[17]=[u(" Delete ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{ze as default};
