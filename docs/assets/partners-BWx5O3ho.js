import{r as d,aF as O,D as z,c as _,o as g,d as s,f as R,l as y,b as t,e as a,Z as m,s as u,t as V,Y as L,a1 as Y}from"./index-qeOE-RZf.js";import{s as f}from"./supabase-530oTR8b.js";import{V as w,b as $,c as h}from"./VCard-DSA5d7tx.js";import{V as Z}from"./VAlert-3engY8ay.js";import{V as G}from"./VDataTable-DIwuVEqw.js";import{V as A}from"./VCardText-esC-nFTL.js";import{V as H}from"./VForm-D3l-Nezn.js";import{b as J}from"./VTextField-l-OaS9z9.js";import{V as E}from"./VSpacer-_ceUCEQo.js";import{V as M}from"./VDialog-BTxMSAHY.js";import"./_commonjsHelpers-BosuxZz1.js";import"./VAvatar-CrC7-P1Q.js";import"./VImg-BuNpeMJc.js";import"./forwardRefs-DWGaNmQL.js";import"./VList-dtqFoHiT.js";import"./ssrBoot-DzfblIhC.js";import"./VDivider-PwI-pKnj.js";import"./VOverlay-CG-9_lFx.js";import"./scopeId-Caf1NDu8.js";import"./lazy-DvqCi__j.js";import"./VMenu-BUbR1i_z.js";import"./VChip-D0U8pgGv.js";/* empty css              */const K={class:"p-6"},Q={class:"mb-8"},W=["src"],X={class:"text-xs text-gray-500"},ee={class:"mb-4"},te=["disabled"],ae={key:0,class:"text-sm text-gray-500 mt-1"},le={key:1,class:"text-sm text-red-500 mt-1"},oe={key:2,class:"mt-2"},re=["src"],$e={__name:"partners",setup(se){const n=d(!1),i=d(""),U=d([]),p=d(!1),c=d(!1),v=d(!1),r=O({id:null,name:"",logo_url:""}),D=d(null),b=d(!1),x=d(""),k=async()=>{n.value=!0,i.value="";const{data:o,error:e}=await f.from("partners").select("*").order("created_at",{ascending:!1});e?i.value=e.message:U.value=o,n.value=!1},S=()=>{v.value=!1,Object.assign(r,{id:null,name:"",logo_url:""}),p.value=!0},j=o=>{v.value=!0,Object.assign(r,o),p.value=!0},P=async()=>{if(!r.name||!r.logo_url){i.value="Name and Logo URL are required";return}n.value=!0,i.value="";let o;v.value?o=await f.from("partners").update({name:r.name,logo_url:r.logo_url}).eq("id",r.id).select():o=await f.from("partners").insert([{name:r.name,logo_url:r.logo_url}]).select(),o.error?i.value=o.error.message:(p.value=!1,k()),n.value=!1},B=o=>{D.value=o,c.value=!0},T=async()=>{n.value=!0,i.value="";const{error:o}=await f.from("partners").delete().eq("id",D.value);o&&(i.value=o.message),c.value=!1,k(),n.value=!1},q=async o=>{const e=o.target.files[0];if(e){b.value=!0,x.value="";try{const l=e.name.split(".").pop(),C=`partner-logo-${Date.now()}-${Math.random().toString(36).substring(2)}.${l}`,{data:F,error:N}=await f.storage.from("product-images").upload(C,e,{cacheControl:"3600",upsert:!1});if(N)throw N;const{data:I}=f.storage.from("product-images").getPublicUrl(F.path);r.logo_url=I.publicUrl}catch(l){x.value=l.message||"Upload failed"}b.value=!1}};return z(k),(o,e)=>(g(),_("div",K,[s("div",Q,[t(w,{flat:"",class:"py-6 px-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4 shadow-none border-b border-gray-200"},{default:a(()=>[e[6]||(e[6]=s("div",null,[s("h2",{class:"text-2xl font-bold mb-1"},"Partners Management"),s("p",{class:"text-gray-500 text-base"}," Manage all partners and their logos displayed on your website. ")],-1)),t(m,{color:"primary",class:"mt-4 md:mt-0",onClick:S,size:"large","prepend-icon":"tabler-plus"},{default:a(()=>e[5]||(e[5]=[u(" Add Partner ")])),_:1})]),_:1})]),i.value?(g(),R(Z,{key:0,type:"error",class:"mb-4"},{default:a(()=>[u(V(i.value),1)]),_:1})):y("",!0),t(G,{items:U.value,loading:n.value,class:"rounded-lg shadow",headers:[{title:"Name",key:"name"},{title:"Logo",key:"logo_url"},{title:"Created",key:"created_at"},{title:"Actions",key:"actions",sortable:!1}],"item-value":"id",density:"comfortable"},{"item.logo_url":a(({item:l})=>[s("img",{src:l.logo_url,alt:"logo",style:{height:"38px","max-width":"100px","object-fit":"contain"}},null,8,W)]),"item.created_at":a(({item:l})=>[s("span",X,V(new Date(l.created_at).toLocaleString()),1)]),"item.actions":a(({item:l})=>[t(m,{icon:"",variant:"text",color:"primary",onClick:C=>j(l)},{default:a(()=>[t(L,{icon:"tabler-edit"})]),_:2},1032,["onClick"]),t(m,{icon:"",variant:"text",color:"error",onClick:C=>B(l.id)},{default:a(()=>[t(L,{icon:"tabler-trash"})]),_:2},1032,["onClick"])]),"no-data":a(()=>e[7]||(e[7]=[s("div",{class:"text-center text-gray-400 py-8"},"No data.",-1)])),_:1},8,["items","loading"]),t(M,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=l=>p.value=l),"max-width":"500"},{default:a(()=>[t(w,null,{default:a(()=>[t($,null,{default:a(()=>[u(V(v.value?"Edit Partner":"Add Partner"),1)]),_:1}),t(A,null,{default:a(()=>[t(H,{onSubmit:Y(P,["prevent"])},{default:a(()=>[t(J,{modelValue:r.name,"onUpdate:modelValue":e[0]||(e[0]=l=>r.name=l),label:"Name",required:"",class:"mb-4"},null,8,["modelValue"]),s("div",ee,[e[8]||(e[8]=s("label",{class:"block font-medium mb-1"},"Logo",-1)),s("input",{type:"file",accept:"image/*",onChange:q,disabled:b.value},null,40,te),b.value?(g(),_("div",ae,"Uploading...")):y("",!0),x.value?(g(),_("div",le,V(x.value),1)):y("",!0),r.logo_url?(g(),_("div",oe,[s("img",{src:r.logo_url,alt:"Partner Logo",style:{"max-width":"120px","max-height":"120px","object-fit":"contain","border-radius":"8px"}},null,8,re)])):y("",!0)])]),_:1})]),_:1}),t(h,null,{default:a(()=>[t(E),t(m,{text:"",onClick:e[1]||(e[1]=l=>p.value=!1)},{default:a(()=>e[9]||(e[9]=[u("Cancel")])),_:1}),t(m,{color:"primary",loading:n.value,onClick:P},{default:a(()=>e[10]||(e[10]=[u(" Save ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(M,{modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=l=>c.value=l),"max-width":"400"},{default:a(()=>[t(w,null,{default:a(()=>[t($,null,{default:a(()=>e[11]||(e[11]=[u("Delete Partner?")])),_:1}),t(A,null,{default:a(()=>e[12]||(e[12]=[u(" Are you sure you want to delete this partner? ")])),_:1}),t(h,null,{default:a(()=>[t(E),t(m,{text:"",onClick:e[3]||(e[3]=l=>c.value=!1)},{default:a(()=>e[13]||(e[13]=[u("Cancel")])),_:1}),t(m,{color:"error",loading:n.value,onClick:T},{default:a(()=>e[14]||(e[14]=[u(" Delete ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{$e as default};
