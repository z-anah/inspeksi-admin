import{_ as $}from"./AppTextarea-BZinC0t2.js";import{_ as q}from"./AppTextField-8E0vsYlW.js";import{i as D,j as P,r as c,aF as B,D as E,c as d,o as u,b as a,e as o,s as f,t as k,f as F,l as y,a1 as N,d as m,F as S,h as I,Z as x,Y as M,m as j}from"./index-qeOE-RZf.js";import{s as g}from"./supabase-530oTR8b.js";import{b as R,c as z,V as L}from"./VCard-DSA5d7tx.js";import{V as O}from"./VCardText-esC-nFTL.js";import{V as Y}from"./VAlert-3engY8ay.js";import{V as Z}from"./VForm-D3l-Nezn.js";import{V as G}from"./VSpacer-_ceUCEQo.js";import"./VTextField-l-OaS9z9.js";import"./VImg-BuNpeMJc.js";import"./forwardRefs-DWGaNmQL.js";import"./VTextarea-C_xe0QJ6.js";import"./_commonjsHelpers-BosuxZz1.js";import"./VAvatar-CrC7-P1Q.js";/* empty css              */const H={class:"p-6 max-w-2xl mx-auto"},J={class:"mb-4"},K=["disabled"],Q={key:0,class:"text-sm text-gray-500 mt-1"},W={key:1,class:"text-sm text-red-500 mt-1"},X={key:2,class:"mt-2"},ee=["src"],te={class:"mb-4"},Ve={__name:"[id]",setup(ae){const C=D(),A=P(),p=c(!1),r=c(""),v=c(C.params.id!=="new"),e=B({id:null,type:"",title:"",published_at:"",image_url:"",content:[]}),_=c(!1),b=c(""),w=async l=>{const t=l.target.files[0];if(t){_.value=!0,b.value="";try{const i=t.name.split(".").pop(),h=`${Date.now()}-${Math.random().toString(36).substring(2)}.${i}`,{data:s,error:n}=await g.storage.from("product-images").upload(h,t,{cacheControl:"3600",upsert:!1});if(n)throw n;const{data:V}=g.storage.from("product-images").getPublicUrl(s.path);e.image_url=V.publicUrl}catch(i){b.value=i.message||"Upload failed"}_.value=!1}},T=async()=>{if(!v.value)return;p.value=!0,r.value="";const{data:l,error:t}=await g.from("articles").select("*").eq("id",C.params.id).single();t?r.value=t.message:Object.assign(e,{...l,content:Array.isArray(l.content)?l.content:l.content?[l.content]:[]}),p.value=!1},U=async()=>{if(!e.type||!e.title||!e.published_at||!e.content.length){r.value="Type, Title, Published Date, and Content are required";return}p.value=!0,r.value="";let l;v.value?l=await g.from("articles").update({type:e.type,title:e.title,published_at:e.published_at,image_url:e.image_url,content:e.content}).eq("id",e.id).select():l=await g.from("articles").insert([{type:e.type,title:e.title,published_at:e.published_at,image_url:e.image_url,content:e.content}]).select(),l.error?r.value=l.error.message:A.push({name:"admin"}),p.value=!1};return E(()=>{v.value&&T()}),(l,t)=>{const i=q,h=$;return u(),d("div",H,[a(L,null,{default:o(()=>[a(R,null,{default:o(()=>[f(k(v.value?"Edit Article":"Add Article"),1)]),_:1}),a(O,null,{default:o(()=>[r.value?(u(),F(Y,{key:0,type:"error",class:"mb-4"},{default:o(()=>[f(k(r.value),1)]),_:1})):y("",!0),a(Z,{onSubmit:N(U,["prevent"])},{default:o(()=>[a(i,{modelValue:e.type,"onUpdate:modelValue":t[0]||(t[0]=s=>e.type=s),label:"Type (e.g. opini, kisah, rilis)",required:"",class:"mb-4"},null,8,["modelValue"]),a(i,{modelValue:e.title,"onUpdate:modelValue":t[1]||(t[1]=s=>e.title=s),label:"Title",required:"",class:"mb-4"},null,8,["modelValue"]),a(i,{modelValue:e.published_at,"onUpdate:modelValue":t[2]||(t[2]=s=>e.published_at=s),label:"Published Date",type:"date",required:"",class:"mb-4"},null,8,["modelValue"]),m("div",J,[t[5]||(t[5]=m("label",{class:"block font-medium mb-1"},"Image",-1)),m("input",{type:"file",accept:"image/*",onChange:w,disabled:_.value},null,40,K),_.value?(u(),d("div",Q,"Uploading...")):y("",!0),b.value?(u(),d("div",W,k(b.value),1)):y("",!0),e.image_url?(u(),d("div",X,[m("img",{src:e.image_url,alt:"Article Image",style:{"max-width":"200px","max-height":"200px"}},null,8,ee)])):y("",!0)]),m("div",te,[t[7]||(t[7]=m("label",{class:"block font-medium mb-1"},"Content Paragraphs",-1)),(u(!0),d(S,null,I(e.content,(s,n)=>(u(),d("div",{key:n,class:"flex items-center gap-2 mb-2"},[a(h,{modelValue:e.content[n],"onUpdate:modelValue":V=>e.content[n]=V,"auto-grow":"",label:"Paragraph",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue"]),a(x,{icon:"",variant:"text",color:"error",onClick:V=>e.content.splice(n,1)},{default:o(()=>[a(M,{icon:"tabler-trash"})]),_:2},1032,["onClick"])]))),128)),a(x,{color:"secondary",variant:"tonal",size:"small",onClick:t[3]||(t[3]=s=>e.content.push(""))},{default:o(()=>t[6]||(t[6]=[f(" Add Paragraph ")])),_:1})])]),_:1})]),_:1}),a(z,null,{default:o(()=>[a(G),a(x,{text:"",onClick:t[4]||(t[4]=s=>j(A).push({name:"admin"}))},{default:o(()=>t[8]||(t[8]=[f("Cancel")])),_:1}),a(x,{color:"primary",loading:p.value,onClick:U},{default:o(()=>t[9]||(t[9]=[f(" Save ")])),_:1},8,["loading"])]),_:1})]),_:1})])}}};export{Ve as default};
